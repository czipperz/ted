#!/bin/bash

cd ~/ted || exit 1

cargo build || exit 1

if [ "$1" = "--doc" ]; then
    tests=""
else
    tests="--tests"
fi
tests+=" -- -q"

status=0
for package in $(find . -maxdepth 1 -type d -name 'ted_*' | perl -pe 's|\./||' | sort) ted; do
    RUST_BACKTRACE=1 cargo test -p $package $tests || status=1
done

exit $status
